<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ë‚˜ì˜ ì›¹ (2270056, ì´ì„¤í•˜)</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    h3 {
      margin-bottom: 10px;
    }
    #info {
      margin-bottom: 20px;
    }
    #main {
      padding: 20px;
      border-radius: 10px;
      background: #f5f5f5;
      min-height: 60px;
      font-size: 20px;
    }
  </style>

  <script>
    // ---- â‘  ë¸Œë¡œì»¤/í† í”½ ì„¤ì • ----
    const brokerUrl = "wss://damoa.io:9002";
    const topic = "ewha/2270056";

    // ---- â‘¡ í´ë¼ì´ì–¸íŠ¸ ID ìƒì„± ----
    const clientId = "iot-client-" + Math.random().toString(16).substr(2, 8);
    const options = { clientId };

    console.log(`MQTT ë¸Œë¡œì»¤(${brokerUrl})ì— ì ‘ì† ì‹œë„...`);
    const client = mqtt.connect(brokerUrl, options);

    // ì ‘ì† ì„±ê³µ
    client.on("connect", () => {
      console.log(`âœ… ì ‘ì† ì„±ê³µ! (clientId: ${clientId})`);

      // í† í”½ êµ¬ë…
      client.subscribe(topic, (err) => {
        if (!err) {
          console.log(`ğŸ“„ í† í”½ êµ¬ë… ì„±ê³µ: ${topic}`);

          // ì¶œì„ ìš© checkin ë©”ì‹œì§€ (í•„ìš” ì—†ìœ¼ë©´ ì£¼ì„ ì²˜ë¦¬í•´ë„ ë¨)
          client.publish("ewha/checkin", "2270056 ì´ì„¤í•˜");
        } else {
          console.error("í† í”½ êµ¬ë… ì˜¤ë¥˜:", err);
        }
      });
    });

    // ë©”ì‹œì§€ ìˆ˜ì‹ 
    client.on("message", (topic, message) => {
      console.log(`${topic} ${message.toString()}`);

      const mainDiv = document.getElementById("main");
      mainDiv.innerHTML = `
        <div class="message-item">
          <b>ë°›ì€ ë©”ì‹œì§€:</b> ${message.toString()}
        </div>
      `;
      mainDiv.scrollTop = mainDiv.scrollHeight;
    });

    // ì—ëŸ¬ ì²˜ë¦¬
    client.on("error", (err) => {
      console.error("ì—°ê²° ì˜¤ë¥˜:", err);
      client.end();
    });
  </script>
</head>

<body>
  <h3>ë‚˜ì˜ ì›¹ (2270056, ì´ì„¤í•˜)</h3>
  <div id="info">
    ë¸Œë¡œì»¤: <b>damoa.io</b><br />
    êµ¬ë… í† í”½: <b>ewha/2270056</b><br />
    ì „ì†¡ ë©”ì‹œì§€ ì˜ˆ: <code>2270056 ì´ì„¤í•˜</code>
  </div>

  <div id="main">
    â³ MQTT ë©”ì‹œì§€ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...
  </div>
</body>
</html>
